<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test: Disable Textbox When Choices are Presented</title>

<script type="text/javascript">

window.addEventListener("message", function(event) {
    console.log("🛰️ [EinsteinBot Listener] Full event object:", event);

    try {
        const payload = event?.data?.data?.eventDetails?.conversationEntry?.entryPayload;

        if (typeof payload === "string") {
            console.log("📦 [EinsteinBot Listener] entryPayload:", payload);

            if (payload.includes("[[PFZ_ENABLE_INPUT]]")) {
                const customEvent = new CustomEvent("EinsteinBotCustomEvent", {
                    detail: {
                        source: "einstein-bot",
                        timestamp: new Date()
                    }
                });
                window.dispatchEvent(customEvent);
                console.log("🚀 [EinsteinBot Listener] Custom event dispatched:", customEvent);
                console.log("🚀 [EinsteinBot Listener] Enabling text entry");
                postIframeEnable();
            } else if (payload.includes("[[PFZ_DISABLE_INPUT]]")) {
                const customEvent = new CustomEvent("EinsteinBotCustomEvent", {
                    detail: {
                        source: "einstein-bot",
                        timestamp: new Date()
                    }
                });
                window.dispatchEvent(customEvent);
                console.log("🚀 [EinsteinBot Listener] Custom event dispatched:", customEvent);
                console.log("🚀 [EinsteinBot Listener] Disabling text entry");
                postIframeDisable();
            } else {
                console.log("🔍 [EinsteinBot Listener] entryPayload received, but no trigger string found.");
            }
        } else {
            console.log("⚠️ [EinsteinBot Listener] entryPayload is not a string or is undefined.");
        }
    } catch (err) {
        console.error("❌ [EinsteinBot Listener] Error processing message event:", err);
    }
});

  // Function to enable user input
  function postIframeEnable() {
    const iframe = document.getElementById("embeddedMessagingFrame");
    if (iframe?.contentWindow) {
      console.log("📤 Sending 'InputEnable' to iframe");
      iframe.contentWindow.postMessage("InputEnable", "*");
    } else {
      console.warn("⚠️ Iframe not found or not ready");
    }
  }

  // Function to disable user input
  function postIframeDisable() {
    const iframe = document.getElementById("embeddedMessagingFrame");
    if (iframe?.contentWindow) {
      console.log("📤 Sending 'InputDisable' to iframe");
      iframe.contentWindow.postMessage("InputDisable", "*");
    } else {
      console.warn("⚠️ Iframe not found or not ready");
    }
  }

  window.addEventListener("message", function (event) {
    if (event.data === "iframe-ready") {
      if (typeof postIframeDisable === "function") {
        postIframeDisable();
      } else {
        console.warn("Function postIframeDisable is not defined.");
      }
    }
  });

const observer = new MutationObserver((mutationsList) => {
  console.log("MutationObserver triggered");

  for (const mutation of mutationsList) {
    for (const node of mutation.addedNodes) {
      if (node.nodeType === Node.ELEMENT_NODE) {
        console.log("New node added:", node);

        if (node.matches("embeddedmessaging-conversation-entry-item")) {
          const text = node.textContent || "";
          console.log("Checking message content:", text);

          if (text.includes("[[PFZ_DISABLE_INPUT]]") || text.includes("[[PFZ_ENABLE_INPUT]]")) {
            console.log("Hiding message:", node);
            node.style.display = "none";
          }
        }
      }
    }
  }
});

// Replace this with the actual selector for your chat container
const chatContainer = document.querySelector("embeddedmessaging-container");

if (chatContainer) {
  console.log("Chat container found:", chatContainer);
  observer.observe(chatContainer, { childList: true, subtree: true });
} else {
  console.warn("Chat container not found. Please check the selector.");
}



</script>


</head>

<body>
  <h1>Test: Disable Textbox When Choices are Presented</h1>
</body>

<script type='text/javascript'>
	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'

			embeddedservice_bootstrap.init(
				'00D9O00000E20tZ',
				'DE_Messaging_for_Web',
				'https://pfizermedinfo--corytest.sandbox.my.site.com/ESWDEMessagingforWeb1731983263831',
				{
					scrt2URL: 'https://pfizermedinfo--corytest.sandbox.my.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};
</script>
<script type='text/javascript' src='https://pfizermedinfo--corytest.sandbox.my.site.com/ESWDEMessagingforWeb1731983263831/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>

</html>